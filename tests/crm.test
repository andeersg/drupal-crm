<?php

/**
 * Tests basic CRM functions.
 */
class CRMBaseTestCase extends DrupalWebTestCase {

  protected $user;
  protected $admin;
  protected $admin_permissions = array(
    'access administration pages',
    'crm manage',
    'crm administer',
    'access content',
  );
  protected $user_permissions = array(
    'access content',
  );

  public static function getInfo() {
    return array(
      'name' => 'CRM',
      'description' => 'Tests basic CRM functions.',
      'group' => 'crm',
    );
  }

  function setUp() {

    $modules = func_get_args();
    if (isset($modules[0]) && is_array($modules[0])) {
      $modules = $modules[0];
    }
    parent::setUp(array('crm') + $modules);

    field_cache_clear();

    $this->admin = $this->drupalCreateUser($this->admin_permissions);
    $this->user = $this->drupalCreateUser($this->user_permissions);
  }

  protected function mergePermissions() {
    $args = func_get_args();
    $permission = array();
    foreach ($args as $arg) {
      if (is_array($arg)) {
        foreach ($arg as $perm) {
          if (!in_array($perm, $permission)) {
            $permission[] = $perm;
          }
        }
      }
      else {
        if (!in_array($arg, $permission)) {
          $permission[] = $arg;
        }
      }
    }
    return $permission;
  }

}
